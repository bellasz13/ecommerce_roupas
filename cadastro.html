<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TrendStore - Cadastro</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

<header class="main-header">
  <div class="menu-icon">
    <a href="perfil.html">
      <img src="imagens/icones/user.png" alt="Menu" width="28" height="28">
    </a>
  </div>

  <div class="logo">
    <a href="index.html">TrendStore</a>
  </div>

  <div class="header-icon">
    <a href="favorito.html">
      <img src="imagens/icones/favorito.png" alt="Favoritos" width="28">
    </a>
    <a href="carrinho.html">
      <img src="imagens/icones/carrinho.png" alt="Carrinho de compras" width="28" height="28">
    </a>
  </div>
</header>

<main>
  <div class="login-container">
    <h1 class="login-title">Crie sua conta</h1>

    <form id="form-cadastro" class="login-form">
      <input type="email" id="email" name="email" placeholder="Email" class="login-input" required>
      <input type="text" id="telefone" name="telefone" placeholder="Telefone" class="login-input" required>
      <input type="text" id="cpf" name="cpf" placeholder="CPF" class="login-input" required>
      <input type="text" id="nome_completo" name="nome_completo" placeholder="Nome completo" class="login-input" required>
      <input type="date" id="data_nascimento" name="data_nascimento" placeholder="Data de Nascimento" class="login-input" required>

      <div class="campo-senha">
        <input type="password" id="senha" name="senha" placeholder="Senha" class="login-input" required>
        <img src="imagens/icones/olho-senha.png" id="toggleSenha" alt="Mostrar senha" class="icone-olho">
      </div>

      <div class="campo-senha">
        <input type="password" id="confirmar-senha" placeholder="Confirmar senha" class="login-input" required>
        <img src="imagens/icones/olho-senha.png" id="toggleConfirmaSenha" alt="Mostrar senha" class="icone-olho">
      </div>

      <button type="submit" class="login-button">Criar conta</button>
    </form>

    <p class="login-register">
      Possui uma conta? <a href="login.html" class="register-link">Realize o login agora mesmo</a>
    </p>
  </div>
</main>

<script>
  document.getElementById('toggleSenha').addEventListener('click', function() {
    const input = document.getElementById('senha');
    input.type = input.type === 'password' ? 'text' : 'password';
  });

  document.getElementById('toggleConfirmaSenha').addEventListener('click', function() {
    const input = document.getElementById('confirmar-senha');
    input.type = input.type === 'password' ? 'text' : 'password';
  });

  const formCadastro = document.getElementById('form-cadastro');

  formCadastro.addEventListener('submit', async function (event) {
    event.preventDefault();

    const senha = document.getElementById('senha').value;
    const confirmar = document.getElementById('confirmar-senha').value;

    if (senha !== confirmar) {
      alert('As senhas não conferem.');
      return;
    }

    const dados = {
      nome_completo: document.getElementById('nome_completo').value,
      email: document.getElementById('email').value,
      telefone: document.getElementById('telefone').value,
      cpf: document.getElementById('cpf').value,
      data_nascimento: document.getElementById('data_nascimento').value,
      senha: senha
    };

    try {
      const resp = await fetch('http://localhost:3000/api/clientes', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(dados)
      });

      if (!resp.ok) {
        const erro = await resp.json().catch(() => ({}));
        alert('Erro ao criar conta: ' + (erro.erro || resp.status));
        return;
      }

      const json = await resp.json();
      console.log('Cliente criado:', json);
      alert('Conta criada com sucesso!');
      window.location.href = 'login.html';
    } catch (e) {
      console.error(e);
      alert('Não foi possível conectar ao servidor. Verifique se a API está rodando.');
    }
  });
</script>

</body>
</html>
